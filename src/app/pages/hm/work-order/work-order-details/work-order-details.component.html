<div *ngIf="loading" class="pause d-flex align-items-center justify-content-center">
  <div class="spinner"></div>
</div>
<div class="content flex-column-fluid auto container-lg mb-4">
    <!-- <div class="py-5 fw-bold">
        <a class="cursor-pointer " routerLink="/job-posts"> <i class="fas fa-arrow-left me-3"></i>
            Create Job Posting for Worker <span class="badge badge-light-success fw-normal ms-3"><i
                    class="fas fa-yin-yangfas fa-circle px-1 text-success  fs-10"></i> New Job</span></a>
    </div> -->
    <!--begin:: Top Card-->

    <div class="card mb-5 mb-xl-10 text-gray-600">
        <div class="card-body">
            <h3 class="card-title fs-4"> 
                <a class="cursor-pointer " routerLink="/hm/work-order"> <i class="fas fa-arrow-left me-3"></i> </a>
                 Work Order -  {{workOrderDetails?.workOrderId}}</h3>
            <span class="text-muted">
                Work orders are detailed instruction or request that outline specific task repairs or service to be performed in a structured or organized manner.
            </span>
      <!-- Tabs Start:: -->
      <div class="d-flex overflow-auto border-bottom my-7">
        <ul class="nav nav-stretch nav-line-tabs nav-line-tabs-2x border-transparent fs-5  flex-nowrap">
          <li class="nav-item"><a class="nav-link cursor-pointer text-active-primary me-6 active"
              (click)="getSelectedTab('Details')" [ngClass]="{'active': isSelectedTab=='Details'}"> Details </a></li>
          <li class="nav-item"><a class="nav-link cursor-pointer text-active-primary me-6"
              (click)="getSelectedTab('Documents'); getDocuments()" [ngClass]="{'active': isSelectedTab=='Documents'}"> Documents </a>
          </li>
          <li class="nav-item"><a class="nav-link cursor-pointer text-active-primary me-6"
            (click)="getSelectedTab('Task'); getTaskList({workOrderId: workOrderDetails?.workOrderId})" [ngClass]="{'active': isSelectedTab=='Task'}">Task
          </a></li>
          <!-- <li class="nav-item"><a class="nav-link cursor-pointer text-active-primary me-6"
              (click)="getSelectedTab('JobSeekers')" [ngClass]="{'active': isSelectedTab=='JobSeekers'}"> Job Seekers
            </a></li>
            <li class="nav-item"><a class="nav-link cursor-pointer text-active-primary me-6"
              (click)="getSelectedTab('Interviewed')" [ngClass]="{'active': isSelectedTab=='Interviewed'}"> Interviewed </a>
          </li> -->
        </ul>
      </div>
      <!-- Tabs End:: -->
      <ng-container *ngIf="isSelectedTab=='Details'">
<div class="d-flex flex-column">

            <h6 class="text-dark  text-gray-800 fs-2  me-1">{{workOrderDetails?.title}}</h6>
            <div class="mt-2 mb-5 text-muted block" [innerHTML]="workOrderDetails?.description">
            </div>




            <div class="d-flex flex-wrap flex-stack ">
              <div class="d-flex flex-column flex-grow-1 pe-8">
                <div class="d-flex flex-wrap lign-items-center">
                  <div class=" me-5 my-1">
                    <span class="d-flex text-muted fs-8">Vendor</span>
                    <span class="fw-bold d-flex s-">{{workOrderDetails?.vendorDetails?.vendorId}} {{workOrderDetails?.vendorDetails?.title}}</span>
                  </div>
                  <div class="vr me-5 mt-4 h-20px "></div>

                  <div class=" me-5 my-1">
                    <span class="d-flex text-muted fs-8">Job Position ID</span>
                    <span class="fw-bold d-flex s-"> <a class="cursor-pointer">
                        {{workOrderDetails?.jobPostId}} <i class="far fa-arrow-alt-circle-right"></i>
                    </a></span>
                  </div>

                  <div class="vr me-5 mt-4 h-20px "></div>
                  <div class=" me-5 my-1 d-flex">
                    <!-- <div class="symbol symbol-30px symbol-square me-3">
                      <span class="symbol-label fs-5 fw-bolder bg-light-warning fs-4">YK </span>
                    </div> -->

                    <div>
                      <span class="d-flex text-muted fs-8">Manager</span>
                      <span class="fw-bold d-flex s-">{{workOrderDetails?.managerDetails?.firstName}} {{workOrderDetails?.managerDetails?.lastName}}</span>
                    </div>
                  </div>
                  <div class="vr me-5 mt-4 h-20px "></div>
                  <div class=" me-5 my-1">
                    <span class="d-flex text-muted fs-8">Work Order Type</span>
                    <span class="fw-bold d-flex s-">{{workOrderDetails?.type}}</span>
                  </div>
                  <div class="vr me-5 mt-4 h-20px "></div>
                  <div class=" me-5 my-1">
                    <span class="d-flex text-muted fs-8">Priority</span>
                    <span class="fw-bold d-flex s-">
                      <!-- <span class="badge badge-light-danger">
                        <i class="fas fa-yin-yangfas fa-circle py-0 pe-2 text-danger fs-10"></i>
                        High
                      </span>  -->
                      <span>
                        {{workOrderDetails?.priority}}
                      </span>
                    </span>
                  </div>
                  <div class="vr me-5 mt-4 h-20px "></div>
                  <div class=" me-5 my-1">
                    <span class="d-flex text-muted fs-8">Stats</span>
                    <span class="fw-bold d-flex s-">
                      <!-- <span class="badge badge-light-warning">
                        In-Progress
                      </span> -->
                      <span>
                        {{workOrderDetails?.status}}
                      </span>
                    </span>
                  </div>
                  <div class="vr me-5 mt-4 h-20px "></div>
                  <div class=" me-5 my-1">
                    <span class="d-flex text-muted fs-8">From Date</span>
                    <span class="fw-bold d-flex s-">{{workOrderDetails?.startDate | date:'MMM dd, yyyy'}}</span>
                  </div>
                  <div class="vr me-5 mt-4 h-20px "></div>
                  <div class=" me-5 my-1">
                    <span class="d-flex text-muted fs-8">To Date</span>
                    <span class="fw-bold d-flex s-">{{workOrderDetails?.endDate | date:'MMM dd, yyyy'}}</span>
                  </div>

                </div>
              </div>
            </div>

          </div>



          <div class="row mt-10">
          <div class="col-md-6  ">
            <div class="card border border-dotted bg-light-dark h-100">
              <div class="card-header">
                <h5 class="card-title">Organization Details & Work Policy</h5>
              </div>
              <div class="card-body pt-0">
  
                <ng-container>
                  <div class="form-group row ">
                    <label class="col-4 col-form-label text-muted">Legal Entity</label>
                    <div class="col-8">
                      <span class="form-control-plaintext">{{workOrderDetails?.companyDetails?.title}}</span>
                    </div>
                  </div>
                </ng-container>
                <div class="separator"></div>
                <ng-container>
                  <div class="form-group row ">
                    <label class="col-4 col-form-label text-muted">Site</label>
                    <div class="col-8">
                      <span class="form-control-plaintext">{{workOrderDetails?.siteDetails?.name}}</span>
                    </div>
                  </div>
                </ng-container>
                <div class="separator"></div>
                <ng-container>
                  <div class="form-group row ">
                    <label class="col-4 col-form-label text-muted">Work Location</label>
                    <div class="col-8">
                      <span class="form-control-plaintext">{{workOrderDetails?.siteDetails?.address1}} {{workOrderDetails?.siteDetails?.address2}}
                        <br>
                        {{workOrderDetails?.siteDetails?.city}}<br>
                        {{workOrderDetails?.siteDetails?.state}}<br>
                        {{workOrderDetails?.siteDetails?.country}}<br>
                        {{workOrderDetails?.siteDetails?.zipcode}}
                      </span>
                    </div>
                  </div>
                </ng-container>
                <div class="separator"></div>
                <ng-container>
                  <div class="form-group row ">
                    <label class="col-4 col-form-label text-muted">Business Unit</label>
                    <div class="col-8">
                      <span class="form-control-plaintext">{{workOrderDetails?.businessUnitDetails?.name}}</span>
                    </div>
                  </div>
                </ng-container>
                <div class="separator"></div>
                <ng-container>
                  <div class="form-group row ">
                    <label class="col-4 col-form-label text-muted">Time Sheet Frequency</label>
                    <div class="col-8">
                      <span class="form-control-plaintext">{{timeSheetFrequencyList[workOrderDetails?.timeSheetFreq]}}</span>
                    </div>
                  </div>
                </ng-container>
                <div class="separator"></div>
                <ng-container>
                  <div class="form-group row ">
                    <label class="col-4 col-form-label text-muted">Hours per Week</label>
                    <div class="col-8">
                      <span class="form-control-plaintext">{{workOrderDetails?.workHours}}</span>
                    </div>
                  </div>
                </ng-container>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card card border border-dotted bg-light-dark h-100 h-100">
              <div class="card-header">
                <h5 class="card-title">Accounting Details</h5>
              </div>
              <div class="card-body pt-0">
                <div class="form-group row ">
                  <label class="col-4 col-form-label text-muted">Cost Center</label>
                  <div class="col-8">
                    <span class="form-control-plaintext text-end">({{workOrderDetails?.constCenterDetails?.code}}) {{workOrderDetails?.constCenterDetails?.name}}</span>
                  </div>
                </div>
                <div class="separator"></div>
                <div class="form-group row ">
                  <label class="col-4 col-form-label text-muted">Payment Terms</label>
                  <div class="col-8">
                    <span class="form-control-plaintext text-end">{{workOrderDetails?.payRate}}</span>
                  </div>
                </div>
                <div class="separator"></div>
                <div class="form-group row ">
                  <label class="col-4 col-form-label text-muted">Work Rate</label>
                  <div class="col-8">
                    <span class="form-control-plaintext text-end">{{workOrderDetails?.minBudget ? (workOrderDetails?.minBudget + '-' + workOrderDetails?.maxBudget) : workOrderDetails?.rate}} {{workOrderDetails?.currency}}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="isSelectedTab=='Documents'">

        <ng-container *ngFor="let documents of documentsList">
            <div class="d-flex align-items-center mb-4 bg-white border rounded p-5 ">
              <!--begin::Icon-->
              <span class="symbol align-middle mr-5 w-70px">
                <img alt="" src="./assets/media/svg/files/pdf.svg"></span>
              <!--end::Icon-->
    
              <!--begin::Title-->
              <div class="d-flex flex-column min-w-50 mr-2 ">
                <a href="#" class="text-dark text-hover-primary mb-1 font-size-lg">{{documents.fileName}}</a>
                <!-- <span class="text-muted ">Uploaded by <a href="">username</a> on Apr 14 2022 08:59 AM</span> -->
              </div>
              <div class="d-flex  w-sm-100 mr-2">
                <span class="badge badge-light-primary w-auto ">{{documents.fileType}}</span>
              </div>
              <!--end::Title-->
    
              <!--begin::Lable-->
              <div class="font-weight-bolder text-warning py-1 font-size-lg w-250px">
                <a class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-3" (click)="downloadDoc(documents.id)"> <i
                    class="fas fa-download"></i></a>
                <a class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm " (click)="downloadDoc(documents.id)"> <i
                    class="far fa-eye"></i></a>
              </div>
              <!--end::Lable-->
            </div>
          </ng-container>

      </ng-container>





      <ng-container *ngIf="isSelectedTab=='Task'">

        <a id="kt_new_task_drawer_toggle" class="btn btn-primary btn-sm cursor-pointer mb-6" (click)="taskDetails = ''"> <i class="bi bi-plus-lg"></i>New Task</a>
<app-new-task-drawer [vendorId]="workOrderDetails?.vendorDetails?.vendorId" [taskDetails]="taskDetails" (getList)="getTaskList({workOrderId: workOrderDetails?.workOrderId})"></app-new-task-drawer>

        <div class="d-flex align-items-start gap-4 ">
            <div class="position-relative input-icon input-icon-right">
                <input type="text" class="form-control py-2 px-3 fs- fw-normal ps-4" [(ngModel)]="filterValue.taskId" (keyup)="applySearchFilter($event)" placeholder="Search By Task Id #"/>
                <span><i class="fa fa-search "></i></span>
            </div>
            <mat-select class="form-select fs- py-2  w-200px" [(value)]="filterValue.priority" (selectionChange)="filterByPriority($event)">
              <mat-option value="All Priorities">All Priorities</mat-option>
              <mat-option value="High">High</mat-option>
              <mat-option value="Low">Low</mat-option>
              <mat-option value="Medium">Medium</mat-option>
            </mat-select>
            <div class="position-relative input-icon input-icon-right">
                <input type="text" class="form-control py-2 px-3 fs- fw-normal ps-4" [(ngModel)]="filterValue.assigneeId" (keyup)="filterByAssignee($event)" placeholder="Search By Assignee"/>
                <span><i class="fa fa-search "></i></span>
            </div>
            <mat-select class="form-select fs- py-2  w-200px" [(value)]="filterValue.status" (selectionChange)="filterByStatus($event)">
              <mat-option value="All Status">All Status</mat-option>
              <mat-option *ngFor="let status of statusLists" [value]="status">
                {{status}}
              </mat-option>
            </mat-select>
            <div class="position-relative input-icon input-icon-right">
                <input type="text" class="form-control py-2 px-3 fs- fw-normal ps-4"
                 placeholder="Select ETA Dates"  (click)="picker3.open()"
                 [matDatepicker]="picker3" [(ngModel)]="filterValue.finishDate" (dateChange)="filterByDate($event.value,'finishDate')"/>
                 <span><i class="far fa-calendar"></i></span>
                 <mat-datepicker #picker3></mat-datepicker>
            </div>
       
          

            <a class="btn btn-light-primary btn-sm cursor-pointer" >Search</a>
            <a class="btn btn-light-primary btn-sm cursor-pointer" (click)="clearFilters()"> Reset</a>
    
        </div>
        
    
        <div class="mt-5 border">
            <table mat-table [dataSource]="dataSource" class="table table-row-bordered text-gray-600" >
          
              <!-- taskId Column -->
              <ng-container matColumnDef="taskId">
                <th mat-header-cell *matHeaderCellDef class="align-middle"><i class="bi bi-hash"></i> Task Id </th>
                <td mat-cell *matCellDef="let element" class="align-middle"> {{element.taskId}} </td>
              </ng-container>
              
              <!-- taskName Column -->
              <ng-container matColumnDef="title">
                <th mat-header-cell *matHeaderCellDef class="align-middle"><i class="bi bi-file-earmark-font"></i> Task Name </th>
                <td mat-cell *matCellDef="let element" class="align-middle"> {{truncateText(element.title, 35)}} </td>
              </ng-container>
            
              
                <!-- priority Column -->
                <ng-container matColumnDef="priority">
                <th mat-header-cell *matHeaderCellDef class="align-middle"><i class="bi bi-tag"></i> Priority </th>
                <td mat-cell *matCellDef="let element" class="align-middle">
                    <span class="badge badge-light-danger" 
                    [ngClass]="{' badge-light-danger text-danger': (element.priority === 'High' || element.priority === 'Medium'),
                     'badge-light-success text-success' : element.priority === 'Low'  }">
                      <i class="fas fa-yin-yangfas fa-circle px-1 fs-10"
                      [ngClass]="{'text-danger': (element.priority === 'High' || element.priority === 'Medium'),
                     'text-success' : element.priority === 'Low'  }"></i>
                      
                      {{element.priority}}</span>
                
                </td>
                </ng-container>

              <!-- assignTo Column -->
              <ng-container matColumnDef="assigneeId">
                <th mat-header-cell *matHeaderCellDef class="align-middle"><i class="bi bi-person"></i>
                  Assign To </th>
                <td mat-cell *matCellDef="let element" class="align-middle">
                  <div  class="symbol symbol-30px symbol-square me-3">
                    <!-- <span  class="symbol-label fs-5 fw-bolder bg-light-warning fs-4">SL </span> -->
                  </div> {{element.assigneeId}} </td>
              </ng-container>
            
                <!-- timeSpent Column -->
                <ng-container matColumnDef="timeSpent">
                    <th mat-header-cell *matHeaderCellDef class="align-middle"><i class="bi bi-clock"></i> Time Spent </th>
                    <td mat-cell *matCellDef="let element" class="align-middle"> {{element.timeSpent}} </td>
                  </ng-container>
                
              <!-- eta Column -->
              <ng-container matColumnDef="finishDate">
                <th mat-header-cell *matHeaderCellDef class="align-middle"><i class="bi bi-calendar"></i> ETA. </th>
                <td mat-cell *matCellDef="let element" class="align-middle"> {{element.finishDate | date:'MMM dd, yyyy'}} </td>
              </ng-container>
            
                 <!-- lastUpdate Column -->
                 <ng-container matColumnDef="lastUpdate">
                    <th mat-header-cell *matHeaderCellDef class="align-middle"><i class="bi bi-calendar"></i> Last Update </th>
                    <td mat-cell *matCellDef="let element" class="align-middle"> {{element.modifierDate | date:'MMM dd, yyyy'}} </td>
                  </ng-container>
      
              <!-- status Column -->
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef class="align-middle"><i class="bi bi-sun"></i> Status </th>
                <td mat-cell *matCellDef="let element" class="align-middle">
                  <span class="badge badge-light-primary">{{element.status}}</span>
              </td>
              </ng-container>
            
              
              <!-- action Column -->
              <ng-container matColumnDef="action">
                <th mat-header-cell *matHeaderCellDef class="align-middle text-center"> </th>
                <td mat-cell *matCellDef="let element" class="align-middle text-center">
                    <a id="kt_new_task_drawer_toggle" (click)="editTask(element.taskId)" class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-3">
                        <i class="bi bi-pencil"></i>
                    </a>
                    <a (click)="deleteTask(element.taskId)" class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm "> 
                        <i class="bi bi-trash"></i>
                    </a>
                    </td>
              </ng-container>
            
              
              
            
              <tr mat-header-row *matHeaderRowDef="displayedColumns" class="bg-light-primary"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;">
              </tr>
            </table>
          </div>
    
    

      </ng-container>


















        </div>
 

    </div>
</div>